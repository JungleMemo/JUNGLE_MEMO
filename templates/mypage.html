{% extends "base_mypage.html" %}

{% block mypage_content %}
<div class="mypage-layout">
    <div class="left-column">
        <div class="profile-container">
            <div class="profile-photo">
                {% if user.profile_photo %}
                    <img id="profile-img" src="data:image/png;base64,{{ user.profile_photo }}" alt="Profile Photo" width="100" height="100">
                {% else %}
                    <img id="profile-img" src="/static/images/default_profile.png" alt="Default Profile" width="100" height="100">
                {% endif %}
            </div>
            <div class="profile-info">
                <p>ì´ë¦„: {{ user.username }}</p>
                <p>ì¢‹ì•„ìš” : {{ total_likes | default(0) }}</p>
            </div>

            <!-- í”„ë¡œí•„ ì‚¬ì§„ ì—…ë¡œë“œ -->
            <input type="file" id="profile_photo" name="profile_photo" accept="image/*">
        </div>
    </div>

    <div class="right-column">
        {% include "components/heatmap.html" %}  {# ğŸ”¥ íˆíŠ¸ë§µ ì¶”ê°€ #}

        <div class="post-list">
            <h3>{{ writer }}ë‹˜ì˜ ì‘ì„±í•œ ê¸€ ëª©ë¡</h3>
            {% if posts %}
                {% for post in posts %}
                    {% include "components/post_card.html" %}
                {% endfor %}
            {% else %}
                <p>ì‘ì„±í•œ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>
            {% endif %}
        </div>
    </div>
</div>

<script>
document.getElementById("profile_photo").addEventListener("change", function(event) {
    let formData = new FormData();
    let fileInput = event.target.files[0];
    
    if (!fileInput) {
        return;
    }

    formData.append("profile_photo", fileInput);

    fetch("/update_profile_photo", {
        method: "POST",
        body: formData,
        credentials: "include"
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert(data.message);
            location.reload();  // ë³€ê²½ëœ í”„ë¡œí•„ ë°˜ì˜ì„ ìœ„í•´ ìƒˆë¡œê³ ì¹¨
        } else {
            alert("í”„ë¡œí•„ ì‚¬ì§„ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨!");
        }
    })
    .catch(error => console.error("Error:", error));
});
</script>

{% endblock %}
